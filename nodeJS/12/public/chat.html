<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="socket.io.min.js"></script>
</head>
<body>
    用户名: <input type="text" class="name" /><button class="jinru">进入聊天室</button>
    <div class="num"></div>
    <div class="msg"></div>
    <input type="text" class="txt">
    <button onclick="submit()">发送</button>
    <div class="userList"></div>
    <script>
        // 引入socket的时候 会在window下添加一个io全局方法
        // websocket
        //  1.http连接方式进行连接,并且告诉服务器要创建一个websocket连接
        //  2.服务器
        //  3.正式建立websocket连接
        // let socket = io.connect('/');
        let div = document.getElementsByClassName('msg')[0];
        let num = document.getElementsByClassName('num')[0];
        let txt = document.getElementsByClassName('txt')[0];
        let name = document.getElementsByClassName('name')[0];
        let jinru = document.getElementsByClassName('jinru')[0];
        let userList = document.getElementsByClassName('userList')[0];
        let socket;
        let userId;

        jinru.onclick = function(){
            let text = name.value;
            init(text);
            // socket.emit('login',{
            //     name: text,
            //     userId: Date.now()
            // });
        };

        function init(username){
            userId = Date.now();
            name = username;
            socket = io.connect('/');
            socket.emit('login',{
                name: name,
                userId: userId
            });
            socket.on('login',(data)=>{
                div.innerHTML += data.data.name + ' 加入了聊天室 <br/>';
                num.innerHTML = `当前在线人数: ${data.data.userNum}<br/>`;
                userList.innerHTML = '当前在线列表 <br/>';
                for(let i in data.userList){
                    console.log(data.userList[i]);
                    userList.innerHTML += `${data.userList[i]}<br/>`;
                };
                // console.log(data.userNum);
            });
            socket.on('logout',(data)=>{
                div.innerHTML += data.name + ' 退出了聊天室 <br/>';
                num.innerHTML = `当前在线人数: ${data.iNum}<br/>`;
                userList.innerHTML = '当前在线列表 <br/>';
                for(let i in data.userList){
                    console.log(data.userList[i]);
                    userList.innerHTML += `${data.userList[i]}<br/>`;
                };
            });
            socket.on('liaotian',(data)=>{
                div.innerHTML += `${data.txt}<br/>`;
            });
        };

        function submit(){
            console.log(txt.value);
            socket.emit('msg',{
                txt: txt.value
            });
        };
        // socket.on('liaotian',(data)=>{
        //     div.innerHTML += data.txt + '<br/>';
        // });
        // socket.on('login',(data)=>{
        //     div.innerHTML += data.name + ' 加入了聊天室 <br/>';
        // });
        // socket.on('login',(data)=>{
        //     div.innerHTML += data.name + ' 加入了聊天室 <br/>';
        // });
        // socket.on('merry',(data)=>{
        //     console.log(data);
        //     socket.emit('thank',{
        //         content: 'receive'
        //     });
        // });
    </script>
</body>
</html>